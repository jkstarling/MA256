---
title: ''
geometry: "left=2cm,right=2cm,top=1cm,bottom=2cm"
output:
  pdf_document:
    extra_dependencies: ["xcolor", "amsmath","multicol"]
  html_document: default
editor_options:
  markdown:
    wrap: 100
---

```{r setup, message=FALSE, echo=TRUE, include=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

\newcommand{\sol}[1]{\color{violet} #1 \color{black}}

<!-- \renewcommand{\sol}[1]{} -->


<!-- xcolor standard colors: 
black, blue, brown, cyan, darkgray, green, lime, magenta, olive, orange, red, purple, teal, violet, yellow, etc.  -->

```{r include=FALSE, message=FALSE}
library(tidyverse)
library(lubridate)

houses <- read_csv("https://raw.githubusercontent.com/jkstarling/MA256/main/data/Houses.csv")

```


# MA256 Lesson 17 \& 18 - Multiple Variables and Interactions (Causality and Multiple Regression Supplement Ch3 \& 4)

Many people say that you can predict the cost of a home (in thousands of USD) based on its size (square footage) because bigger homes cost more to build, so I’d like for you to verify this claim using a random sample of homes around Lake Michigan (Houses.csv). 

## A1.)	Identify and classify the variables of interest.

Explanatory: \sol{Home size (in square feet) - Quantitative}

Response:  \sol{Price (in thousands of USD) - Quantitative}

## A2.)	Define the coefficient symbols and interpret what they represent (in context) given the simple linear regression equation in the form of $y = \beta_0 + \beta_1*sqft$.

$\beta_0$ \sol{(Intercept Coefficient): the average price of a 0 sqft home (vacant lot). }

$\beta_1$ \sol{(Slope Coefficient): the population slope is the predicted increase in average price (in thousands of USD) for every one-square-foot increase in home size.}

## A3.)	Express the null and alternate hypotheses in words & symbols.

$H_0:$ \sol{$\beta_1 = 0$. There is no association between the size of a home and its price.}

$H_a:$ \sol{$\beta_1 \ne 0$. There is a positive association between the size of a home and its price.} 



## A4.)	Create a scatterplot of Home Size vs Price, and add a layer (`geom_smooth`) to include the best-fitting least squares regression line. Describe what you see. 

```{r out.width="40%"}
houses %>% ggplot(aes(x = sqft, y = `price in thousands`)) + 
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) + 
  labs(x="Home Size in Square Feet", y = "Home Price in Thousands",
       title = "Home Price vs. Square Feet")
```




## A5.)	Use the Course Guide example R Code for Lesson 18-19 to find estimates of the fitted model and then write the complete equation for `house.lm` given the form of $y = \beta_0 + \beta_1 * sqft$. Are the 4 validity conditions met for us to use the theory-based approach to assess strength of evidence? Use headers to explicitly state each of them, and then clarify if they are met.

```{r out.width="40%"}
house.lm <- houses %>% lm(`price in thousands` ~ sqft, data = .)
summary(house.lm)

house.lm %>%
  fortify(house.lm$model) %>%  # fortify converts a model to a dataframe
  ggplot(aes(x = .fitted, 
             y = .resid)) +
  geom_point() +
  geom_hline(yintercept = 0) +
  labs( x = "Predicted Values", 
        y = "Residuals", 
        title = "Residuals vs. Predicted Values")

house.lm %>%
  fortify(house.lm$model) %>%
  ggplot(aes(x = .resid)) +
  geom_histogram() +
  labs(x = "Residuals", y = "Count",
       title = "Histogram of Residuals")
```

\sol{Price= -59.36870 + 0.21274*sqft}

Linearity: \sol{The data seems to generally follow a linear trend.} 

Independence (New): \sol{It makes sense the home prices are independent from one another e.g. if my neighbor’s house has ugly paint inside that won’t influence my house price – or – if my neighbor’s house only has 2 bathrooms but mine has 4 that won’t effect my home price. }

Normality: \sol{Equal number of observations above (6) and below (7) the line. }

Equal Variance: \sol{There is an approximately equal variance throughout the entire domain, given flexibility due to small sample size. }



## A6.)	Interpret your slope and intercept coefficients:

Slope Coefficient: \sol{The increase in average price (in thousands of USD) for every 1 sqft increase in home size is 0.21274. }

Alternative Interpretation: \sol{The increase in average price for every 1 square foot increase in home size is \$212.74 (0.21274 * 1,000 since price is in thousands).}


Intercept Coefficient: \sol{The average price (in thousands of USD) of a 0 square foot home is 
-59.36870. }

Alternative Interpretation: \sol{The average price of a 0 square foot home is -\$59,368.70 
(-59.36870 * 1,000 since price is in thousands).}


## A7.)	Would you be comfortable using your model to predict the price of a 0 sqft home (vacant lot)? Why or why not? 

\sol{Since positive numbers indicate money flowing from a buyer to a seller to purchase their property, and since the intercept coefficient is negative, it doesn’t make sense that someone would pay me \$59,368.70 to “purchase” a vacant lot i.e. 0 square foot home. I am not comfortable using my model in this way. WE MUST ALWAYS USE CAUTION WHEN EXTRAPOLATING WITH OUR MODEL. }


### A7.) If we want to predict prices for vacant lots, what should we use to create a model?

\sol{If we wanted to predict the prices of vacant lots, perhaps we should only use vacant lots to create a new least squares regression model. }


## A8.)	Calculate the 95\% confidence interval for the slope statistic and provide an interpretation of the CI.

```{r}
sqft.coef <- summary(house.lm)$coefficients['sqft','Estimate']
sqft.se <- summary(house.lm)$coefficients['sqft','Std. Error']
multiplier <- qt(0.975, df = 11)
c(sqft.coef - multiplier*sqft.se, sqft.coef + multiplier*sqft.se)
```

\sol{The 95\% CI = Statistic ± mult*SD. Since the slope coefficient (statistic) is 0.21274, since its Standard Error (SE) is 0.06963, and the multiplier is approx 2.2, the 95\% CI can be calculated as follows:\\
Lower Bound: 0.21274 – (2.2*0.06963) = 0.0595\\
Upper Bound: 0.21274 + (2.2*0.06963) = 0.3660\\
95\% CI: (0.0595, 0.3660)\\
I am 95\% confident that a 1 sqft increase in home size is associated with an average increase of 0.0595 thousands of USD to 0.3660 thousands of USD in home price for homes around Lake Michigan.}

## A9.)	Briefly explain why location i.e. lakefront (=1) or non-lakefront (=0), may be another explanatory variable. 

\sol{Lake houses are traditionally more expensive than non-lakefront houses. Lake impacts the response variables.}


## A10.)	 Does lakefront effect price and sqft? Create a new scatterplot that is colored based on lakefront status. 
```{r out.width="40%"}
houses %>% ggplot(aes(x = sqft, y = `price in thousands`, color = as.factor(lake))) +
  geom_point()
```


\sol{Based on the scatterplot results, it seems like even the smallest lakefront homes are more expensive than the largest non-lakefront homes that are twice the size (in sqft). }


## A11.) We can adjust for the additional explanatory variable by including it in a multiple regression model. In this model, we estimate the price per square foot when we hold the location of the house constant.

$price_i = \beta_0 + \beta_1*sqft_i + \beta_2*lake_i$

where $price_i$ is the price of house $i$, $sqft_i$ is the size (sq ft) of house $i$, and $lake_i$ is 1 if house $i$ is lakefront and 0 if not lakefront. It may help to think of “$i$" as a counter from house #1 to #13

Create a new model with lake as an additional variable to create a scatter plot to view the new model. 

```{r out.width="40%"}
house.lake.lm <- houses %>% lm(`price in thousands` ~ sqft + lake, data = .)
  
houses <- houses %>% mutate(price.predict = predict(house.lake.lm, newdata = .),
        	 residuals = `price in thousands` - price.predict)

houses %>% ggplot(aes(x = sqft, y = `price in thousands`, color = as.factor(lake))) +
  geom_line(aes(x=sqft, y=house.lake.lm$fitted.values)) +
  geom_point(aes(y = `price in thousands`)) +
  labs(x="Home Size in Square Feet", y="Home Price in Thousands of USD", 
       		color="Lakefront Status", 
       		title="Home Price in Thousands of USD vs Size in Square Feet")

```



## A12.)	Based on the slopes of the two lines, what assumption does this model make about the price per square foot? 

\sol{The slope for both the lakefront and non-lakefront homes is the same i.e. the price per square foot is the same regardless of whether a home is on the lake (no “interaction”). }




## A13.)	How do we interpret $\beta_0,  \beta_1, \beta_2$ given the regression line equation in the form of $price_i = \beta_0 + \beta_1*sqft_i + \beta_2*lake_i$?

$\beta_0$: \sol{The price of a 0 square foot home (vacant lot) that is not on the lake.}

$\beta_1$: \sol{The change in average price of a home for every 1 square foot change in home size after adjusting for location (lakefront or not lakefront). }

$\beta_2$: \sol{The increase in average price because a home is lakefront after adjusting for size.}
	
	
## A14.)	 What is our new regression model with lakefront status as an additional variable in the form of $price_i = \beta_0 + \beta_1*sqft_i + \beta_2*lake_i$? 

```{r}
summary(house.lake.lm)
```

\sol{$Price_i = -70.1821 + 0.1481*sqft_i + 331.2235*lake_i$}


## A15.)	Calculate Prices of 2500 sqft houses on the lake and not on the lake. 
```{r}
predict(house.lake.lm, data.frame(sqft = 2500, lake = 1))
predict(house.lake.lm, data.frame(sqft = 2500, lake = 0))
```


\sol{2500 sqft Lakefront: -70.1821 + 0.1481*(2500) + 331.2235*(1) = \$631,260.40}

\sol{2500 sqft Non Lakefront: -70.1821 + 0.1481*(2500) + 331.2235*(0) = \$300,036.90}



## A16.)	 How did the price per square foot (slope) change compared to when we held location constant?


\sol{The price per square foot decreased from \$212.74 (0.21274) to \$148.10 (0.1481) because the majority of the price difference was due to the lakefront premium. }


## A17.)	 Which model predicts home price more accurately?

\sol{The first model had a coefficient of determination (R Squared) of 0.4591 so it accounted for 45.91\% of the variance in Price due to size. The second model has an R Squared of 0.9255 so it accounted for 92.55\% in home price due to size and location.}


## A18.) Use the Course Guide example R Code for Lesson 18-19 as a template to plot the residuals vs predicted values to determine whether there is evidence of an interaction?  


```{r out.width="40%"}
house.lake.lm %>%
  fortify(house.lake.lm$model) %>%  # fortify converts a model to a dataframe
  ggplot(aes(x = .fitted, 
             y = .resid,
             color = as.factor(lake))) +
  geom_point() +
  geom_hline(yintercept = 0) +
  labs( x = "Predicted Values", 
        y = "Residuals", 
        title = "Residuals vs. Predicted Values")

```

\sol{ For non-lakefront homes, the trend in the residuals (Predicted – Actual) shows that the slope of the least-squares regression line overestimates home prices initially (lower sqft homes), and then underestimates them for larger sqft homes. \\
     For lakefront homes, the trend in residuals underestimates home prices initially (lower sqft homes), and overestimates prices for larger sqft homes.\\
     Therefore, adding an interaction term will allow the slopes to be individually tailored to each set of data rather than assuming the price per square foot would be the same regardless of location. This is further validated by looking at this following diagram, and recognizing that the best fit line for blue dots by themselves would have a more positive slope, while the best fit line for red dots would be less positive.}


## A19.)	 Create and provide the new model that includes an interaction between lake and sqft and takes the form $price_i = \beta_0 + \beta_1*sqft_i + \beta_2*lake_i + \beta_3*sqft_i*lake_i$? 

```{r}
house.int.lm <- houses %>% lm(`price in thousands` ~ sqft * lake, data = .)
summary(house.int.lm)
```

\sol{$Price_i = 58.11341 + 0.08394*sqft_i + 28.65098*lake_i + 0.13595* sqft_i*lake_i$.}


## A20.)	 Which of the 3 models had the highest accuracy? 

\sol{The interaction model had an R-Squared (Coefficient of Determination) value of 0.9684 so it accounts for 96.84\% of the variance in home price that is attributed to sqft and location. }


## A21.) Create a scatterplot that shows the predicted linear models for those houses on a lake and those away from it using the interaction model. 

```{r out.width="40%"}
houses%>%
 ggplot(aes(x=sqft,y=`price in thousands`, color=as.factor(lake)))+
 geom_point()+
 geom_smooth(method = "lm")+
 labs(x="Home Size in Square Feet", y="Home Price in Thousands of USD", 
 	title="Home Price in Thousands of USD vs Size in Square Feet")
```

## A22.) How do we interpret the two slope coefficients associated with the size of a home i.e. sqft and sqft*lake given the least squared regression equation of: 
$price_i = 58.11341 + 0.08394*sqft_i + 28.65098*lake_i + 0.13595* sqft_i*lake_i$.

\sol{The price per square foot for non-lakefront homes is simply 0.08394*sqft = \$83.94 per sqft because lake = 0 which eliminates the second sqft term. However, when lake=1 (lakefront homes), the price per square foot becomes (0.08394 + 0.13595)*sqft = 0.21989*sqft = \$219.89 per sqft. }


## A23.)	 Is there evidence that the price per square foot is different for lakefront and nonlakefront homes? How do you know?

\sol{Yes. The p-value associated with the interaction term is 0.00682, which is statistically significant because it provides very strong evidence against the null hypothesis of no interaction term, as long as the validity conditions are met for this model.}


## A24.)	 The main effect of location (by itself) is not significant in the model with an interaction. Should we conclude that the location of the house is not associated with price? Justify your answer. 

\sol{No. Location is significant in that it modifies the effect of size through the interaction.}



## A25.)	 Use the Course Guide example R Code for Lesson 18-19 as a template to assess whether the model that includes lakefront status meets the four validity conditions (LINE):

```{r out.width="40%"}
house.int.lm %>%
  fortify(house.int.lm$model) %>%  # fortify converts a model to a dataframe
  ggplot(aes(x = .fitted, 
             y = .resid,
             color = as.factor(lake))) +
  geom_point() +
  geom_hline(yintercept = 0) +
  labs( x = "Predicted Values", 
        y = "Residuals", 
        title = "Residuals vs. Predicted Values")

house.int.lm %>%
  fortify(house.int.lm$model) %>%
  ggplot(aes(x = .resid)) +
  geom_histogram() +
  labs(x = "Residuals", y = "Count",
       title = "Histogram of Residuals")
```

\sol{Line \& Equal Variance assessed in one step by comparing predicted values \& residuals: }
\sol{There are no trends in the residuals vs predicted values data so we meet the linear validity condition criteria. Also, the variance appears to be approximately even above and below the line for the entire domain, so we meet that validity condition also.  }
 
\sol{Independence assessed via context of the problem: \\
We use context of the problem to identify if random sampling or random assignment occurred. When there is no “random” anything, with some critical thinking, it will become apparent whether the observations are independent from one another. }

\sol{Normality assessed via histogram of residuals:
The data appears to be centered just below data with wide tails on both sides of the center, which means it is approximately normal since there are no significant outliers strongly skewing the histogram. }











